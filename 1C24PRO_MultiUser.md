# 1C24.PRO — Мультипользовательский доступ (MVP)

> Модель: один владелец + приглашения по SMS (как 42Clouds, но без паролей)
> Версия: 15.02.2026

---

## Роли (MVP — только две)

| Роль | Кто | Что может |
|------|-----|-----------|
| **owner** | Первый зарегистрировавший ИНН | Всё: приглашать, удалять, загружать базы, видеть оплату |
| **user** | Приглашённый сотрудник | Видеть базы, работать в 1С. Не может управлять людьми |

> **Фаза 2:** роль `admin`, открытый вход по ИНН, автоверификация по ЕГРЮЛ.

---

## Как это работает

### 1. Owner регистрируется (описано в UserStory)
```
Телефон → SMS-код → ИНН → DaData → Organization + User(role=owner)
```

### 2. Owner приглашает сотрудника

ЛК → Сотрудники → [+ Пригласить] → вводит телефон

```
POST /api/v1/org/invite  {phone: "+79997654321"}

→ Создание Invite {phone, org_id, status: "pending", expires: +7 дней}
→ SMS: «Вас пригласили в 1C24.PRO (ООО «Рассвет»). Зайдите на 1c24.pro»
```

### 3. Сотрудник принимает

Заходит на 1c24.pro → телефон → SMS-код →
система видит invite → показывает «Присоединиться к ООО Рассвет» →
**ИНН не спрашиваем** (орг из invite)

```
POST /auth/accept-invite {invite_id}
→ User(org_id, role: "user", invited_by: owner)
→ JWT tokens → dashboard
→ SMS owner: «Сидорова Анна присоединилась»
```

### 4. Увольнение

Owner → [Отключить] → мгновенная блокировка:
- Инвалидация JWT в Redis
- Middleware проверяет status на каждом запросе → 403
- SMS: «Ваш доступ отключён»
- Восстановление: owner может включить обратно

### 5. Потерянный owner

Кнопка «Владелец недоступен?» → заявка в поддержку →
наш админ проверяет по ЕГРЮЛ (DaData → текущий директор) →
ручная передача владения.

### 6. Добровольная передача

Owner → Профиль → [Передать владение] → выбор сотрудника → SMS-подтверждение →
старый owner → user, новый → owner. Необратимо.

---

## Матрица прав (MVP)

| Действие | owner | user |
|----------|:-----:|:----:|
| Приглашать / отключать | ✅ | ❌ |
| Загружать базы | ✅ | ❌ |
| Видеть базы и работать в 1С | ✅ | ✅ |
| Управлять тарифом / оплатой | ✅ | ❌ |
| Передать владение | ✅ | ❌ |
| Добавить свой email | ✅ | ✅ |

## Лимиты: тест — 3 чел, Старт — от 1, Бизнес — от 5, Корпорация — от 15.

---

## API (MVP)

```
POST   /api/v1/org/invite               → пригласить по телефону
GET    /api/v1/org/invites              → список приглашений
DELETE /api/v1/org/invites/{id}         → отменить
GET    /api/v1/org/members              → список сотрудников
POST   /api/v1/org/members/{id}/disable → отключить
POST   /api/v1/org/members/{id}/enable  → восстановить
POST   /api/v1/org/transfer-ownership   → передать владение (+ SMS)
POST   /api/v1/auth/accept-invite       → принять приглашение
POST   /api/v1/support/ownership-claim  → запрос восстановления
```

## Модель Invite

| Поле | Тип | Описание |
|------|-----|----------|
| id | UUID, PK | |
| organization_id | FK → Organization | |
| phone | string(20) | Телефон приглашённого |
| invited_by | FK → User | |
| status | string(20) | pending / accepted / expired / cancelled |
| created_at | datetime | |
| expires_at | datetime | +7 дней |
